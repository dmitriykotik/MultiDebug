# MultiDebug
`MultiDebug` - это набор инструментов для удалённой отладки, под разные платформы и языки.

Основной частью `MultiDebug` являются библиотеки `MultiDebug.Server` и `MultiDebug.Client`. Данные библиотеки написаны на C# .NET 8.0. Бибилиотека `MultiDebug.Server` отвечает за создание сервера удалённой отладки. Для создания сервера понадобится IP адрес и свободный интернет порт. Библиотека `MultiDebug.Client` поможет вам создать клиент для удалённой отладки. Данный проект распространяется с исходным кодом, чтобы независимые разработчики могли создавать или улучшать инструменты `MultiDebug`.

`MultiDebug` содержит не только библиотеки, но и готовые сборки выполняемых приложений. В основном таким приложением является клиент. 

В документации ниже Вы сможете разобраться в структуре данного проекта, а также как вы можете взаимодействовать с уже собранными файлами.

# Поддержка
Вы можете поддержать `MultiDebug`, оставив свой отзыв использования или оставив предложения для добавления новых функций. Вы также можете принять учатстие в проекте. Или поддержать финансово: [DonationAlerts](https://www.donationalerts.com/r/dmitryy090209).

Связаться: support@dmitriykotik.ru

Сотрудничество: collab@dmitriykotik.ru

# Структура проекта
В корневой папке имеются следующие директории: `MultiDebugAndroid`, `MultiDebugGodot`, `MultiDebugNET`

## MultiDebugAndroid
Данный проект содержит клиент `MultiDebug`, для взаимодействия с серверной части приложения, которое поддерживает `MultiDebug`. Этот проект написан на `Kotlin`, с использованием `Android Studio`. Для сборки вам понадобится `Android SDK` версии `31`. 

## MultiDebugGodot
`MultiDebugGodot` - это плагин для игрового движка `Godot`. Данный проект содержит сервер и клиент `MultiDebug`. 

> [!CAUTION]
> Чтобы использовать плагин `MultiDebug` для `Godot` требуется ОБЯЗАТЕЛЬНОЕ наличие `Godot` с поддержкой языка программирования `C#`. Плагин `MultiDebug` для `Godot` нативно не поддерживает исключительно язык программирования `GDScript`, так как плагин использует оригинальные библиотеки `MultiDebug.Server` и `MultiDebug.Client`, которые написаны на `C#`. Если ваш проект `Godot` написан исключительно на `GDScript`, и вы не хотите использовать язык `C#`, то вы можете вызывать функции `C#` из `GDScript`, об этом будет написано в документации, ниже.

## MultiDebugNET
Это основной проект `MultiDebug`. Данный проект содержит как библиотеки, так и выполняемые файлы `MultiDebug`.

# MultiDebugNET
Проект `MultiDebugNET` разделён на 4 проекта: `MultiDebug.Server`, `MultiDebug.Client`, `MultiDebug.Server_exe`, `MultiDebug.Client_exe`.

## MultiDebug.Server
Проект `MultiDebug.Server` содержит внутри следующие ключевые файлы: `ClientContext.cs`, `MDServer.cs`, `MsgType.cs`, `SrvMessage.cs`. Сам проект помогает создать сервер `MultiDebug`.

### ClientContext.cs - ClientContext
Данный класс содержит в себе информацию о подключённых клиентах.
```csharp
public class ClientContext
{
    public TcpClient TcpClient { get; }
    public NetworkStream Stream => TcpClient.GetStream();
    public bool IsAuthenticated { get; set; } = false;

    public ClientContext(TcpClient client)
    {
        TcpClient = client;
    }
}
```

### MDServer.cs - MDServer
Основной класс проекта. С помощью данного класса вы можете создать сервер, отправлять клиенту сообщения, и другое. 

#### Создание сервера
Для создания сервера вам нужно воспользоваться конструкцией класса `MDServer.`
```csharp
var server = new MDServer(5000, false, true, "admin");
```
Первый параметр `5000` отвечает за порт, на котором будет запущен сервер `MultiDebug`. Второй параметр `false` отвечает за режим сервера, `true` - режим отладки, `false` - режим релиза. При режиме "отладки" пароль для авторизации не требуется, в режиме релиза - требуется. Третий параметр отвечает за активацию сервера после сборки, при `false` сервер не будет запущен после запуска приложения. Последний, четвёртый, параметр отвечает за пароль, который требуется при авторизации в `MultiDebug`.

Вы также можете создать сервер не указывая параметров.
```csharp
var server = new MDServer();
```
В таком случае сервер будет запущен с параметрами из примера выше.

На данном этапе сервер ещё не активирован, его можно запустить следующим кодом.
```csharp
await server.StartAsync();
```

`MultiDebug` также поддерживает выполнение команд пользователем. Для добавления своей команды вы можете использовать следующий код.
```csharp
server.RegisterCommand("test", async (ctx, args) =>
{
    // Выполняемый код
});
```
Первый параметр `test` - это сама команда, которую должен ввести пользователь для выполнения кода. Второй параметр состоит из нескольких. `ctx` - название новой переменной, в которой будет хранится сам клиент. `args` - название новой переменной, в которой будут аргументы, которые ввёл клиент при выполнении команды. 
> [!NOTE]  
> Регистрация команд должна происходить раньше, чем выполнится запуск сервера, т.е. до строки с кодом `await server.StartAsync();`.

> [!NOTE]  
> Создание сервера обязательно должно происходить в асинхронном методе.

#### Отправка сообщений
Вы можете отправлять как глобальные так и локальные сообщения. Глобальные сообщения нужны для логирования, а локальные нужны при выполнении созданных вами команд. Перед отправкой сообщений вы должны создать и запустить сервер.

Для отправки глобальных сообщений вы можете использовать следующий метод.
```csharp
await server.BroadcastAsync(MsgType.Info, "test");
```
Первый параметр `MsgType.Info` отвечает за тип отправляемого сообщения (см. документацию класса `MsgType`). Второй параметр `test` содержит текст сообщения. Отправка должна происходить в асинхронном методе.

Вы можете отправлять локальные сообщения, но в основном это нужно только в случае использования команд. По этой причине следующий пример будет с использованием конструкции команд, т.к. это единственный более "доступный" вариант использования личной отправки.
```csharp
await server.SendToAsync(ctx, MsgType.Info, "test");
```
Первый параметр `ctx` отвечает за информацию о клиенте (`ClientContext`), эта переменная используется при создании команды, т.е.
```csharp
server.RegisterCommand("test", async (ctx, args) =>
{
    // Выполняемый код
});
```
Второй параметр `MsgType.Info` отвечает  за тип отправляемого сообщения (см. документацию класса `MsgType`). Второй параметр `test` содержит текст сообщения. Отправка должна происходить в асинхронном методе.

Полный пример:
```csharp
server.RegisterCommand("test", async (ctx, args) =>
{
    await server.SendToAsync(ctx, MsgType.Info, "test");
});
```

### MsgType.cs - MsgType
Это `enum` структура, содержащая в себе необходимые типы отправляемых сообщений. 
```csharp
public enum MsgType
{
    Info,
    Debug,
    Error,
    Warning,
    None,
    Passwd,
}
```
`Info` - Информационное сообщение. `Debug` - Отладочное сообщение. `Error` - Ошибка. `Warning` - Предупреждение. `None` - Пустое или неопределённое сообщение и/или тип. `Passwd` - Системное сообщение, предупреждающее о вводе пароля, нельзя использовать при отправке сообщения в `SendToAsync` и/или `BroadcastAsync`.

### SrvMessage.cs - SrvMessage
Данный класс содержит в себе структуру серверных сообщений.
```csharp
public class SrvMessage
{
    public MsgType Type { get; }
    public string Content { get; }

    public SrvMessage(MsgType type, string content)
    {
        Type = type;
        Content = content;
    }

    public override string ToString() => $"{Type}:{Content}";

}
```

# MultiDebugGodot
`MultiDebugGodot` - Это лишь плагин для `Godot`, созданный на `C#`. Для его работы понадобится специальная версия `Godot`, с поддержкой `C#`. Загрузить её вы можете на официальном сайте https://godotengine.org . Этому плагину нужен `C#`, т.к. он использует библиотеки `MultiDebug`, которые были написаны на языке `C#`. Но даже если Вы пишите скрипты на `GDScript` - это вам не помешает, т.к. `Godot` поддерживает вызов `C#` функций из `GDScript`. Ниже Вы узнаете как правильно подключить плагин, а также как им пользоваться из `C#` и `GDScript`.

## Подключение
- После открытия проекта создайте любой скрипт `C#`, в любом месте, если проект `C#` ещё не был создан. После чего вы можете удалять данный скрипт. 

- Распакуйте архив `MultiDebug.Godot.zip` в корневую директорию Вашего проекта. В случае необходимости объедините папки addons.

- Откройте `.csproj` файл из корневой папки Вашего проекта в текстовом редакторе. После `</PropertyGroup>` или внутри блока `Project` добавьте следующую строку: 
```
<Import Project="addons\multidebug\MultiDebug.props" />
```

Должно получится что-то такое:
```csharp
<Project Sdk="Godot.NET.Sdk/4.4.0">
  <PropertyGroup>
    <TargetFramework>net8.0</TargetFramework>
    <EnableDynamicLoading>true</EnableDynamicLoading>
  </PropertyGroup>
  
  <Import Project="addons\multidebug\MultiDebug.props" />
</Project>
```

- Скомпилируйте проект. Это необходимо, чтобы все файлы `MultiDebug` скомпилировались, для дальнейшего использования.

- Перейдите во вкладку "Проект -> Настройки проекта -> Модули".

- Поставьте галочку над плагином `MultiDebug`

- Готово! `MultiDebug Client` подключён к инспектору справа, а `MultiDebug Server` будет автоматически запущен после запуска проекта. Вы также можете настроить сервер перейдя во вкладку "Проект -> Настройка проекта -> Основное -> Multidebug -> Server". 

Порт по умолчанию: 5000

Пароль по умолчанию: admin

> [!NOTE]  
> В случае, если Вы выполнили всё не так как написано в инструкции, и у вас ничего не работает, то просто пробуйте компилировать проект и включать/выключать плагин. Если Вам это не помогло, то попробуйте достать бубен и станцевать напротив вашего компьютера. Если и это не помогло... Да поможет вам Бог.

## Использование в коде
### CSharp
Чтобы вызвать метод `Broadcast` (Стандартный метод для отправки сообщений всем пользователем) в `C#` `Godot` вам нужно вписать следующую строку кода: 
```csharp
Server.Instance?.Broadcast(Type, Msg);
```
`Type` - Тип сообщения, `MsgType` в `MultiDebug.Server`

`Msg` - Текст сообщения, заключённый в кавычки.

### GDScript
Чтобы вызвать метод `Broadcast` (Стандартный метод для отправки сообщений всем пользователем) в `GDScript` вам нужно вписать следующую строку кода:
```gdscript
MDS.Broadcast(Type, Msg)
```
`Type` - Тип сообщения, числовое значение `MsgType` из `MultiDebug.Server`, `Info` - 0, `Debug` - 1, `Error` - 2, `Warning` - 3.

`Msg` - Текст сообщения, заключённый в кавычки.

## Создание команд
Команды для сервера `MultiDebug` в `Godot` можно создавать только на `C#` в файле `Server.cs`, расположенный по пути: `addons\multidebug\Scripts\Server.cs`. Ознакомьтесь с пунктом "Создание сервера", который расположен выше.